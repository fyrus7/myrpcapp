<!DOCTYPE html>
<html>
<head>
  <style>

    body {
      font-family: 'K2D', sans-serif;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: url("https://app.iamfyrus.com/media/futuristic2.jpg") no-repeat center center fixed;
      background-size: cover;
    }

    .glass-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      padding: 50px;
      box-shadow: 0px 15px 20px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      text-align: center;
    }

    /* Adjust the content position from the top */
    .content-container {
      margin-top: 5px; /* Move the content-container and everything inside it down */
    }
    
    /* Box container style */
    .container {
      background-color: #E8ECEF;
      border: solid 0.5px #000000;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      width: 300px;
      margin-top: 30px; /* Move the container down from the top */
    }

    /* Add custom styles for the input boxes */
    .input-box {
      width: 200px; /* Adjust this value to make the box longer */
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.15);
      text-align: center;
    }

.submit-button {
  width: 120px;
//  height: 40px;
  font-size: 16px;
  color: #ffffff;
  background-color: #455A64;
  padding: 5px;
  cursor: pointer;
  border: none;
  border-radius: 5px;
  transition: background-color 0.3s ease;
}

/* Hover effect bila aktif */
.submit-button:hover:not(:disabled) {
  background-color: #1C313A;
}

/* State disable */
.submit-button:disabled {
  background-color: #9E9E9E; /* Grey */
  cursor: not-allowed;
  opacity: 0.8;
}

#numpad {
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transition: all 0.3s ease-in-out;
  margin-top: 20px;
//  margin-bottom: 20px;
}

#numpad.active {
  max-height: 300px; /* cukup tinggi utk grid */
  opacity: 1;
}

.numpad-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  width: 200px;
  margin: auto;
}

#numpad button {
  padding: 15px;
  font-size: 20px;
  border-radius: 8px;
  border: 1px solid #455A64;
  background: #E8ECEF;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
}

#numpad button:hover {
  background: #CFD8DC;
}
/* Besarkan icon untuk butang hide */
#numpad .numpad-hide i {
  font-size: 26px;   /* besar sikit dari nombor */
  line-height: 1;
}


    .copyright-text {
      text-align: center;
      font-size: 0.85em;
      color: #888;
      margin-top: 20px;
    }


.container {
  position: relative; /* jadikan parent utk absolute positioning */
}

/* Toggle overlay di atas kiri dalam container */
.dark-toggle-btn {
  position: absolute;
  top: 10px;
  left: 10px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 5px;
  border-radius: 5px;
}


.dark-toggle-btn i {
  color: #202123; /* light mode */
  font-size: 20px;
  transition: color 0.2s;
}

body.dark-mode .dark-toggle-btn i {
  color: #e4e6eb; /* dark mode */
}

.dark-toggle-btn:hover {
  background-color: rgba(255,255,255,0.1);
  border-radius: 5px;
}

/* Light mode: asal */
#logoImg {
  filter: none;
  transition: filter 0.3s ease;
}

/* Dark mode: invert */
body.dark-mode #logoImg {
  filter: invert(1);
}

/* DARK MODE LOGIN */
body.dark-mode {
  background-color: #202123; /* dark background */
  background-image: none; /* remove light overlay image */
  color: #e4e6eb; /* teks terang */
}

/* Container kotak login */
body.dark-mode .container {
  background-color: #2a2b2e;
  border: 0.5px solid #444; /* terang sikit daripada black */
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
  color: #e4e6eb;
}

/* Input box */
body.dark-mode .input-box {
  background-color: #343538;
  color: #e4e6eb;
  border: 1px solid #555;
}

/* Placeholder text */
body.dark-mode .input-box::placeholder {
  color: #aaa;
}

/* Submit button */
body.dark-mode .submit-button {
  background-color: #455A64; /* sama macam light mode */
  color: #ffffff;
}

body.dark-mode .submit-button:hover:not(:disabled) {
  background-color: #1C313A; /* hover tetap gelap */
}

body.dark-mode .submit-button:disabled {
  background-color: #9E9E9E;
}

/* Numpad */
body.dark-mode #numpad button {
  background-color: #2a2b2e;
  color: #e4e6eb;
  border: 1px solid #555;
}

body.dark-mode #numpad button:hover {
  background-color: #444549;
}

/* Numpad hide icon */
body.dark-mode #numpad .numpad-hide i {
  color: #e4e6eb;
}

/* Optional: content-container */
body.dark-mode .content-container {
  color: #e4e6eb;
}

  </style>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <title>Login Page</title>
</head>
<body>
  <div class="glass-container">
  <!------------- BODY SECTION ------------->


  <center>
  <!--  <div class="content-container"> -->
  <!--  <div class="container"> -->
  <!-- Toggle absolute -->
  <button class="dark-toggle-btn" onclick="toggleDarkMode()">
    <i class="bi bi-moon-fill"></i>
  </button>

      <!-- Image above the page -->
    <img id="logoImg" src="https://app.iamfyrus.com/media/flogoblack2.png" alt="Logo" width="200">

  <br><br>

  <!-- Login Form -->
  <form id="login-form">
      <!-- Replace Dropdown with Username Input Field -->
    <!--  <input type="text" id="username" name="username" class="input-box" placeholder="Enter Username"><br><br> -->
<!-- Input password -->
<div style="position: relative; margin-bottom: 5px;">
  <input type="password" id="pwd" name="password" class="input-box" placeholder="Enter Password" onclick="showNumpad()" readonly><br><br>
  <span id="toggle-password" class="bi bi-eye-slash" style="
    position: absolute;
    right: 10px;
    top: 35%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 18px;
    text-shadow: 0 0 1px #455A64;
  "></span>
</div>

<!-- Login button -->
<button type="button" id="submit-btn" onclick="loginWithNumpad()" class="submit-button">Login</button>

<!-- Virtual Numpad -->
<div id="numpad" class="numpad-hidden">
  <div class="numpad-grid">
    <button type="button" onclick="pressKey('1')">1</button>
    <button type="button" onclick="pressKey('2')">2</button>
    <button type="button" onclick="pressKey('3')">3</button>
    <button type="button" onclick="pressKey('4')">4</button>
    <button type="button" onclick="pressKey('5')">5</button>
    <button type="button" onclick="pressKey('6')">6</button>
    <button type="button" onclick="pressKey('7')">7</button>
    <button type="button" onclick="pressKey('8')">8</button>
    <button type="button" onclick="pressKey('9')">9</button>
    <button type="button" onclick="deleteKey()">⌫</button>
    <button type="button" onclick="pressKey('0')">0</button>
    <button type="button" onclick="hideNumpad()" class="numpad-hide"><i class="bi bi-chevron-up"></i>
</button>

  </div>
</div>

  </form>

  <div id="error-message" style="color:red; font-weight:bold; margin-top:10px; font-size:18px;"></div>
  <br>

  <div id="loader" class="loader"></div>


      iamfyrus | rpc v6.2
</div>

  <!------------- BODY SECTION ------------->
<script>
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('darkMode', isDark);

  // Tukar icon moon/sun (Bootstrap icon)
  const icon = document.querySelector('.dark-toggle-btn i');
  if(icon) {
    if(isDark) {
      icon.classList.remove('bi-moon-fill');
      icon.classList.add('bi-sun-fill');
    } else {
      icon.classList.remove('bi-sun-fill');
      icon.classList.add('bi-moon-fill');
    }
  }
}

// Apply saved preference on page load
window.addEventListener('DOMContentLoaded', () => {
  if(localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
    const icon = document.querySelector('.dark-toggle-btn i');
    if(icon) {
      icon.classList.remove('bi-moon-fill');
      icon.classList.add('bi-sun-fill');
    }
  }
});

// Sync dark mode across tabs
window.addEventListener('storage', (e) => {
  if(e.key === 'darkMode') {
    if(e.newValue === 'true') {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
  }
});
  // =========================
// CONFIG
// =========================
const WEB_APP_URL = "https://rpcworkers.iamfyrus.workers.dev"; // <-- UPDATE!!!

// =========================
// NUMPAD FUNCTIONS
// =========================
function loginWithNumpad() {
  hideNumpad();
  validateLogin();
}

function showNumpad() {
  document.getElementById("numpad").classList.add("active");
}

function hideNumpad() {
  document.getElementById("numpad").classList.remove("active");
}

function pressKey(num) {
  const input = document.getElementById("pwd");
  input.value += num;
}

function deleteKey() {
  const input = document.getElementById("pwd");
  input.value = input.value.slice(0, -1);
}

// =========================
// AUTO LOGIN CHECK
// =========================
window.onload = async function () {
  const submitButton = document.getElementById('submit-btn');

  submitButton.innerText = "Verifying...";
  submitButton.disabled = true;

  const token = localStorage.getItem('sessionToken');

  // ❌ Tiada token → terus enable
  if (!token) {
    submitButton.innerText = "Login";
    submitButton.disabled = false;
    return;
  }

  // ✅ Validate melalui GAS backend
  const res = await fetch(WEB_APP_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action: "validate", token: token })
  });

  const data = await res.json();

  if (data.valid) {
    loadDashboard(data.profile);
  } else {
    localStorage.removeItem('sessionToken');
    localStorage.removeItem('userProfile');
    submitButton.innerText = "Login";
    submitButton.disabled = false;
  }
};

// =========================
// ENTER KEY LOGIN
// =========================
document.getElementById('pwd').addEventListener('keydown', function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    hideNumpad();
    validateLogin();
  }
});

// =========================
// SHOW/HIDE PASSWORD
// =========================
document.getElementById('toggle-password').addEventListener('click', function () {
  const passwordInput = document.getElementById('pwd');
  const toggleIcon = document.getElementById('toggle-password');
  if (passwordInput.type === "password") {
    passwordInput.type = "text";
    toggleIcon.classList.replace('bi-eye-slash', 'bi-eye');
  } else {
    passwordInput.type = "password";
    toggleIcon.classList.replace('bi-eye', 'bi-eye-slash');
  }
});

// =========================
// LOGIN
// =========================
async function validateLogin() {
  const enteredPassword = document.getElementById('pwd').value;
  const submitButton = document.getElementById('submit-btn');
  const errorMessage = document.getElementById('error-message');

  errorMessage.innerText = "";
  submitButton.innerText = "Loading...";
  submitButton.disabled = true;

  if (!enteredPassword) {
    errorMessage.innerText = "Please enter your password.";
    submitButton.innerText = "Login";
    submitButton.disabled = false;
    return;
  }

  const res = await fetch(WEB_APP_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "login",
      password: enteredPassword
    })
  });

  const data = await res.json();

  submitButton.innerText = "Login";
  submitButton.disabled = false;

  if (data.success) {
    localStorage.setItem('sessionToken', data.token);
    localStorage.setItem('userProfile', data.profile);

    loadDashboard(data.profile);
  } else {
    errorMessage.innerText = "Wrong Password";
  }
}

// =========================
// REDIRECT AFTER LOGIN
// =========================
function loadDashboard(profile) {
  profile = profile.toLowerCase();
  localStorage.setItem('userProfile', profile);

  if (profile === "admin_add" || profile === "master") {
    window.location.href = "registration.html";
  }
  else if (profile === "moderator") {
    window.location.href = "admin.html";
  }
  else {
    window.location.href = "dashboard.html";
  }
}
</script>
